#cloud-config
# Cloud-Init Hints:
# * Some default settings are in /etc/cloud/cloud.cfg
# * Some examples at: http://bazaar.launchpad.net/~cloud-init-dev/cloud-init/trunk/files/head:/doc/examples/
# * CloudInit Module sourcecode at: http://bazaar.launchpad.net/~cloud-init-dev/cloud-init/trunk/files/head:/cloudinit/config/
 
preserve_hostname: true
manage_etc_hosts: false
 
# dynamically set hostname using the instance's instanceid
bootcmd:
 - cloud-init-per instance my_set_hostname sh -xc "echo elasticsearch-$INSTANCE_ID > /etc/hostname; hostname -F /etc/hostname"
 - cloud-init-per instance my_etc_hosts sh -xc "sed -i -e '/^127.0.1.1/d' /etc/hosts; echo 127.0.1.1 elasticsearch-$INSTANCE_ID.salekseev.com elasticsearch-$INSTANCE_ID >> /etc/hosts"
 
package_update: true
package_upgrade: true
package_reboot_if_required: true
 
# Install additional packages on first boot
packages:
 - wget
 - git
 - rubygems
 - puppet
 - librarian-puppet
 
# set the locale
locale: en_US.UTF-8
 
# timezone: set the timezone for this instance (ALWAYS user UTC!)
timezone: UTC
 
# Log all cloud-init process output (info & errors) to a logfile
output: {all: ">> /var/log/cloud-init-output.log"}
 
# final_message written to log when cloud-init processes are finished
final_message: "System boot (via cloud-init) is COMPLETE, after $UPTIME seconds. Finished at $TIMESTAMP"
